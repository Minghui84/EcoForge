<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EcoForge: Steel Plant Sustainability Challenge</title>
    <style>
        /* Cover Page Styles */
        .cover-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('img/Backstory_Main1.png') center/cover;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 1000;
        }



        .cover-page h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #fff;
        }

        .cover-page p {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .start-button {
            background: #4CAF50;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 25px;
            transition: transform 0.3s;
        }

        .start-button:hover {
            transform: scale(1.05);
            background: #45a049;
        }
		.card-image {
			height: 350px;
			overflow: auto;
			object-fit: cover;
			border-radius: 5px 5px 0 0;
			margin-bottom: 10px;
		}

		.card {
			padding: 0;
			overflow: hidden;
		}

		.card h3, .card p {
			padding: 0 10px;
		}

		.card p:last-child {
			padding-bottom: 10px;
		}
        .cover-content {
            max-width: 800px;
            background: rgba(0, 50, 0, 0.8);
            padding: 30px;
            border-radius: 10px;
		}

        /* Game Styles */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
		.cover-images {
			display: flex;
			gap: 20px;
			margin: 20px 0;
			justify-content: center;
		}

		.cover-images img {
			max-width: 300px;
			border-radius: 8px;
			border: 2px solid #4CAF50;
			box-shadow: 0 4px 8px rgba(0,0,0,0.3);
		}

        .game-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none; /* Hidden initially */
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-item {
            background: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .hand {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 10px;
			margin: 20px 0;
			min-height: 800px;;
        }

        .card {
            background: #dff0d8;
            border: 1px solid #3c763d;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .card:hover {
            transform: scale(1.02);
            background: #d0e9c6;
        }

        .projects {
            margin-top: 20px;
        }

        .project {
            background: #fcf8e3;
            border: 1px solid #8a6d3b;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }

        button {
            background: #337ab7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .score-system {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }

		.chart-container {
			display: flex;
			justify-content: space-between;
			gap: 20px;
			flex-wrap: wrap;
		}

		.chart-container canvas {
			width: 100%;
			max-width: 350px;
			height: 250px;
		}

		canvas {
			   background: white;
			   padding: 10px;
			   border-radius: 8px;
			   box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
    </style>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>

<body>
    <!-- Cover Page -->
    <div class="cover-page">
    <div class="cover-content">
        <h1>Welcome to EcoForge Sustainability Challenge</h1>
        <h3 class="authors">Created by Coline Goffinon, Riccardo Terzi and Minghui Zhang</h3>
	<div class="cover-images">
    <img src="img/EcoForge_Office.png" alt="Office Assumptions">
	<img src="img/EcoForge_Plant.png" alt="Manufacturing Plant Assumptions">
	
	</div>
	
        <p>
            You recently took on a role as a Chief Energy Officer (CENO) for a new Steel Manufacturing Plant 
            owned by a company called EcoForge in France. The board of directors has set ambitious net-zero 
            objectives that you need to achieve through strategic energy decisions.<br><br>
            
            Each turn, you will receive budget allocations and can choose from various sustainability 
            initiatives to implement. Balance cost, environmental impact, and project timelines to 
            meet the emission reduction targets while maintaining operational efficiency.
        </p>

  <!-- Add this inside the .cover-content div, after the paragraph but before the buttons -->
   <div class="button-container">
            <button class="start-button" onclick="startGame()">Begin Your Mission</button>
            <a href="EcoForge_Process.html" class="start-button">View Innovations</a>
	    <a href="EcoForge_Configure.html" class="start-button">Configure Assumptions</a>
        </div>


<style>
    /* Add this to the existing CSS */
    .assumptions-table {
        max-height: 400px;
        overflow-y: auto;
        margin: 20px 0;
        background: rgba(255,255,255,0.1);
        border-radius: 5px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        color: white;
    }

    th, td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    th {
        background-color: rgba(0,80,0,0.5);
    }

    a {
        color: #7fdbff;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }
</style>     


    </div>
</div>



    <!-- Game Container -->
    <div class="game-container">
        <h1>Steel Plant Sustainability Challenge</h1>
	<h3 class="authors">Created by Coline Goffinon, Riccardo Terzi and Minghui Zhang</h3>

    <style>
        .authors {
            color: #666;
            text-align: center;
            margin-top: -10px;
            margin-bottom: 20px;
            font-weight: normal;

	  /* Add to existing CSS */
		.button-container {
			display: flex;
			gap: 20px;
			justify-content: center;
			margin-top: 20px;
		}

    .start-button, .info-button {
        color: white;
        padding: 15px 40px;
        font-size: 1.2em;
        border-radius: 25px;
        transition: transform 0.3s;
        display: inline-block;
        text-decoration: none;
        border: none;
        cursor: pointer;
    }

    .start-button {
        background: #4CAF50;
    }

    .start-button:hover {
        background: #45a049;
        transform: scale(1.05);
    }

    .info-button {
        background: #3498db;
    }

    .info-button:hover {
        background: #2980b9;
        transform: scale(1.05);
    }

    </style>
        <div class="status-bar">
            <div class="status-item">
                <h3>Turn <span id="turnCount">0</span>/15</h3>
            </div>
            <div class="status-item">
                <h3>Budget: €<span id="budget">0</span>M</h3>
            </div>
            <div class="status-item">
                <h3>Emissions: <span id="emissions">500</span> tons</h3>
            </div>
        </div>

        <h2>Ongoing Projects</h2>
        <div id="projects" class="projects"></div>

        <h2>Available Initiatives</h2>
        <div id="hand" class="hand"></div>

        <div class="score-system">
            <h3>Score Components</h3>
            <p>Total Costs: €<span id="totalCost">0</span>M</p>
            <p>Turns Taken: <span id="totalTurns">0</span></p>
            <p>Emissions Reduced: <span id="totalReduction">0</span> tons</p>
            <p>Total Score: <span id="totalScore">0</span></p>
		<div class="chart-container">
        	<canvas id="scoreBreakdownChart"></canvas>
        	<canvas id="emissionsProgressChart"></canvas>
        </div>

        <button onclick="endTurn()">End Turn</button>
        <button onclick="restartGame()">Restart Game</button>
    </div>

 <script>
    let scoreChart;
    let emissionsChart;
    let emissionsHistory = [];
    let game;

    class InitiativeCard {
      constructor(name, description, cost, duration, reduction, image) {
        this.name = name;
        this.description = description;
        this.cost = cost;
        this.duration = duration;
        this.reduction = reduction;
        this.image = image;
        this.progress = 0;
      }
    }

    function startGame() {
      document.querySelector('.cover-page').style.display = 'none';
      document.querySelector('.game-container').style.display = 'block';

      setTimeout(() => {
        emissionsHistory = [200];
        game = new Game();
        initializeCharts();
      }, 10);
    }

    function initializeCharts() {
      if (scoreChart) scoreChart.destroy();
      if (emissionsChart) emissionsChart.destroy();

      const ctx1 = document.getElementById('scoreBreakdownChart').getContext('2d');
      scoreChart = new Chart(ctx1, {
        type: 'doughnut',
        data: {
          labels: ['Reduction Points', 'Cost Penalty', 'Turn Penalty'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: ['#4CAF50', '#FF5252', '#FFC107']
          }]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Score Components Breakdown' } }
        }
      });

      const ctx2 = document.getElementById('emissionsProgressChart').getContext('2d');
      emissionsChart = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: ['Start'],
          datasets: [{
            label: 'Emissions (tons)',
            data: emissionsHistory,
            borderColor: '#2196F3',
            tension: 0.4,
            fill: false
          }]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Emissions Reduction Progress' } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function renderGameUI(gameInstance) {
	console.log("Hand:", gameInstance.hand);
      const handDiv = document.getElementById('hand');
      handDiv.innerHTML = gameInstance.hand.map((card, index) => `
        <div class="card" onclick="game.fundInitiative(${index})">
          <img src="${card.image}" alt="${card.name}" class="card-image">
          <h3>${card.name}</h3>
          <p>${card.description}</p>
          <p>Cost: €${card.cost}M</p>
          <p>Duration: ${card.duration} turns</p>
          <p>Reduction: ${card.reduction} tons</p>
        </div>
      `).join('');

      const projectsDiv = document.getElementById('projects');
      projectsDiv.innerHTML = gameInstance.ongoingProjects.map(project => `
        <div class="project">
          <h4>${project.name}</h4>
          <progress value="${project.progress}" max="${project.duration}"></progress>
          <p>${project.progress}/${project.duration} turns</p>
        </div>
      `).join('');
    }

    function updateCharts() {
	 if (!game) return; // <-- prevents the error when game is not ready
      const reductionPoints = game.totalReduction * 100;
      const costPenalty = game.totalSpent * 10;
      const turnPenalty = game.turn * 50;

      scoreChart.data.datasets[0].data = [reductionPoints, costPenalty, turnPenalty];
      scoreChart.update();

      
        emissionsChart.data.labels.push(`Turn ${game.turn}`);
        emissionsChart.data.datasets[0].data.push(game.emissions);
        emissionsHistory.push(game.emissions);
        emissionsChart.update();
      
    }

    function endTurn() {
      game.turn++;
      game.budget = Math.min(game.budget + 10, game.maxBudget);
      game.processProjects();
      game.drawHand(1);

      if (game.turn >= 15 || game.emissions <= 10) {
        game.updateUI();
        showResults();
      } else {
        game.updateUI();
      }
    }

    function showResults() {
      const message = game.emissions <= 10
        ? "Success! Plant meets sustainability targets!"
        : "Failed to meet emission reduction goals...";

      const scoreBreakdown = `
        Total Reduction: ${game.totalReduction} tons × 100 = ${game.totalReduction * 100}
        Total Costs: €${game.totalSpent}M × 10 = ${game.totalSpent * 10}
        Turns Taken: ${game.turn} × 50 = ${game.turn * 50}
        Final Score: ${game.calculateScore()}
      `;

      alert(`${message}\n\n${scoreBreakdown}`);
    }

    function restartGame() {
      emissionsHistory = [200];
      if (scoreChart) scoreChart.destroy();
      if (emissionsChart) emissionsChart.destroy();
      document.querySelector('.game-container').style.display = 'block';

      setTimeout(() => {
        game = new Game();
        initializeCharts();
        game.updateUI();
      }, 10);
    }

    class Game {
      constructor() {
        this.turn = 0;
        this.budget = 100;
        this.maxBudget = 200;
        this.emissions = 200;
        this.totalReduction = 0;
        this.totalSpent = 0;
        this.ongoingProjects = [];
        this.deck = this.createDeck();
        this.hand = [];
        this.initGame();
      }

      createDeck() {
        const actions = [
          {
            name: "Green Energy Purchase",
            desc: "Purchase renewable energy certificates",
            cost: () => Math.floor(Math.random() * 20 + 10),
            duration: () => Math.floor(Math.random() * 3 + 1),
            reduction: () => Math.floor(Math.random() * 35 + 5),
            image: "img/green-energy.png"
          },
          {
            name: "Solar PV Installation",
            desc: "Install rooftop solar panels",
            cost: () => Math.floor(Math.random() * 40 + 20),
            duration: () => Math.floor(Math.random() * 4 + 2),
            reduction: () => Math.floor(Math.random() * 50 + 20),
            image: "img/solar-panel.png"
          },
          {
            name: "EV Fleet Transition",
            desc: "Replace vehicles with electric models",
            cost: () => Math.floor(Math.random() * 35 + 15),
            duration: () => Math.floor(Math.random() * 3 + 1),
            reduction: () => Math.floor(Math.random() * 40 + 10),
            image: "img/ev-fleet.png"
          }
        ];

        let deck = [];
			for (let i = 0; i < 10; i++) { // 3 types × 10 = 30 cards total
			for (let action of actions) {
			deck.push(new InitiativeCard(
				action.name,
				action.desc,
				action.cost(),
				action.duration(),
				action.reduction(),
				action.image
          ));
			}
	  }
        console.log("Deck:", deck); 
        return this.shuffleDeck(deck);
      }

      shuffleDeck(deck) {
        return deck.sort(() => Math.random() - 0.5);
      }

      initGame() {
        this.drawHand(6);
        this.updateUI();
      }

      updateUI() {
        document.getElementById('turnCount').textContent = this.turn;
        document.getElementById('budget').textContent = this.budget;
        document.getElementById('emissions').textContent = this.emissions;
        document.getElementById('totalCost').textContent = this.totalSpent;
        document.getElementById('totalTurns').textContent = this.turn;
        document.getElementById('totalReduction').textContent = this.totalReduction;
        document.getElementById('totalScore').textContent = this.calculateScore();
        renderGameUI(this);
        updateCharts();
      }

      drawHand(num) {
		  const slotsAvailable = 6 - this.hand.length;
		  const cardsToDraw = Math.min(num, slotsAvailable, this.deck.length);

		  for (let i = 0; i < cardsToDraw; i++) {
			this.hand.push(this.deck.pop());
		  }
      }

      fundInitiative(cardIndex) {
		  const card = this.hand[cardIndex];
		  if (this.budget >= card.cost) {
			this.budget -= card.cost;
			this.totalSpent += card.cost;
			this.ongoingProjects.push(card);
			this.hand.splice(cardIndex, 1);
			this.drawHand(1);  // ← Add this line to replenish the hand
			this.updateUI();
		  } else {
			alert("Not enough budget!");
		  }
		}


      processProjects() {
        this.ongoingProjects = this.ongoingProjects.filter(project => {
          project.progress++;
          if (project.progress >= project.duration) {
            this.totalReduction += project.reduction;
            this.emissions = Math.max(0, this.emissions - project.reduction);
            return false;
          }
          return true;
        });
      }

      calculateScore() {
        return (this.totalReduction * 100) - (this.totalSpent * 10) - (this.turn * 50);
      }
    }
  </script>
</body>
</html>